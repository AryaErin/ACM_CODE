
树哈希
f[u] = 1 + \sum{f[v] + prime[sz[v]}

```cpp
//#pragma GCC optimize("O3")
//#pragma comment(linker, "/STACK:1024000000,1024000000")
#include<bits/stdc++.h>
using namespace std;
const int MAXN = 333;
typedef uint64_t ull;
int num,n;
vector<ull> vec[MAXN],prime;
ull hval[MAXN];
vector<int> G[MAXN];

void sieve(){
    vector<bool> pm(MAXN+1,true);
    for(int i = 2; i < MAXN; i++){
        if(pm[i]) prime.push_back(i);
        for(int j = 0; j < (int)prime.size(); j++){
            if(i*prime[j]>=MAXN) break;
            pm[i*prime[j]] = false;
            if(i%prime[j]==0) break;
        }
    }
}
int sz[MAXN],maxsz[MAXN];
void dfs(int u, int fa){
    sz[u] = 1; maxsz[u] = 0;
    for(int i = 0; i < (int)G[u].size(); i++){
        int v = G[u][i];
        if(v==fa) continue;
        dfs(v,u);
        sz[u] += sz[v];
        maxsz[u] = max(maxsz[u],sz[v]);
    }
    maxsz[u] = max(maxsz[u],n-sz[u]);
}
void rua(int u, int fa){
    hval[u] = 1ull;
    sz[u] = 1;
    for(int i = 0; i < (int)G[u].size(); i++){
        int v = G[u][i];
        if(v==fa) continue;
        rua(v,u);
        sz[u] += sz[v];
        hval[u] += hval[v] * prime[sz[v]];
    }
}
int main(){
    sieve();
    cin >> num;
    for(int x = 1; x <= num; x++){
        cin >> n;
        for(int i = 1; i <= n; i++) G[i].clear();
        for(int i = 1; i <= n; i++){
            int fa; cin >> fa;
            if(!fa) continue;
            G[fa].push_back(i);
            G[i].push_back(fa);
        }
        dfs(1,0);
        int hsz = *min_element(maxsz+1,maxsz+1+n);
        for(int i = 1; i <= n; i++) if(maxsz[i]==hsz){
            rua(i,0);
            vec[x].push_back(hval[i]);
        }
        sort(vec[x].begin(),vec[x].end());
    }
    for(int i = 1; i <= num; i++){
        bool fg = true;
        for(int j = 1; j < i; j++){
            if(vec[i].size()==vec[j].size() and vec[i]==vec[j]){
                fg = false;
                cout << j << endl;
                break;
            }
        }
        if(fg) cout << i << endl;
    }
    return 0;
}
```
